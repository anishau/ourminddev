<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hearing Voices | ourmind.care</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap">
    <!-- Use the ESM version of Supabase -->
    <script src="https://clerk.browser.accounts.dev/npm/@clerk/clerk-js@4/dist/clerk.browser.js"></script>
    <script>
        window.Clerk.init({
            publishableKey: ''
        });
    </script>
    <style>
        :root {
            --text: #333;
            --bg: #fff;
            --accent: #eee;
            --accent-2: rgba(171, 195, 163, 0.7);
            --accent-3: rgba(173, 216, 230, 0.7);
            --accent-4: rgba(230, 190, 230, 0.7);
            --footer-text: #666;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            color: var(--text);
            background: var(--bg);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            flex: 1;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--accent);
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-links a {
            color: inherit;
            text-decoration: none;
        }

        .nav-links a:hover {
            text-decoration: underline;
        }

        h1, h2, h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        h1 {
            font-size: 2rem;
        }

        h2 {
            font-size: 1.5rem;
        }

        h3 {
            font-size: 1.25rem;
        }

        p {
            margin-bottom: 1rem;
        }

        /* Auth styles */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-modal.visible {
            display: flex;
        }

        .auth-form {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--accent);
            border-radius: 4px;
        }

        button {
            background: var(--text);
            color: var(--bg);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: inherit;
        }

        button:hover {
            opacity: 0.9;
        }

        .site-footer {
            margin-top: 4rem;
            padding: 2rem;
            text-align: center;
            border-top: 1px solid var(--accent);
            color: var(--footer-text);
        }

        /* Content sections */
        .content-grid {
            display: grid;
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .content-card {
            padding: 1.5rem;
            border: 1px solid var(--accent);
            text-decoration: none;
            color: inherit;
            border-radius: 2px;
        }

        .content-card:hover {
            background: var(--accent);
        }

        .content-card h2 {
            margin: 0;
        }

        .content-card p {
            margin: 0.5rem 0 0 0;
            opacity: 0.8;
        }

        /* Exercise sections */
        .key-message {
            background: var(--accent);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 4px;
            font-style: italic;
        }

        .press-pause, .activate-curiosity {
            background: var(--accent);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 4px;
        }

        .press-pause-section, .activate-curiosity-section {
            background: var(--accent-2);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 4px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            align-items: start;
        }

        .activate-curiosity-section {
            background: var(--accent-3);
        }

        .section-content {
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .section-content h3 {
            margin-top: 0;
            margin-bottom: 0.5rem;
        }

        .section-content > p {
            margin-bottom: 0.1rem;
        }

        .journal-entry {
            background: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: 0.25rem;
        }

        .journal-entry textarea {
            width: 100%;
            min-height: 200px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border: 1px solid var(--accent);
            border-radius: 4px;
            font-family: inherit;
            background: white;
            font-size: 1rem;
            line-height: 1.5;
        }

        .past-entries {
            max-height: 150px;
            overflow-y: auto;
            padding-right: 0.5rem;
            border: 1px solid var(--accent);
            border-radius: 4px;
            padding: 0.5rem;
        }

        .past-entries-sidebar {
            position: sticky;
            top: 1rem;
            background: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .past-entries-sidebar h4 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1rem;
            color: var(--footer-text);
        }

        .past-entry {
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--accent);
            border-radius: 4px;
            position: relative;
        }

        .entry-date {
            font-size: 0.875rem;
            color: var(--footer-text);
            margin-bottom: 0.5rem;
        }

        .entry-content {
            white-space: pre-wrap;
            min-height: 1em;
            padding: 0.5rem;
            border: 1px solid transparent;
            font-size: 1rem;
            line-height: 1.5;
        }

        .entry-content:focus {
            outline: none;
            border-color: var(--accent);
            background: white;
            padding: 0.5rem;
        }

        .entry-actions {
            margin-top: 0.5rem;
            text-align: right;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .entry-actions button {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .entry-actions button:hover {
            opacity: 1;
        }

        .delete-edit {
            background: #dc3545;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .press-pause-section, .activate-curiosity-section {
                grid-template-columns: 1fr;
            }
            
            .past-entries-sidebar {
                position: static;
                margin-top: 1rem;
            }
        }

        /* Keep the textarea styles as they're used by hearing-voices.md and paranoia.md */
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border: 1px solid var(--accent);
            border-radius: 4px;
            font-family: inherit;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <div class="nav-links">
                <a href="/" class="logo">ourmind.care</a>
                <a href="/hearing-voices">Hearing Voices</a>
                <a href="/paranoia">Paranoia</a>
                <a href="/field_notes">Field Notes</a>
            </div>
            <div class="auth-nav">
                <button id="authButton" class="auth-button">Sign In</button>
                <div id="authModal" class="auth-modal">
                    <div id="authContainer"></div>
                </div>
            </div>
        </nav>

        
        <h1 class="title">
            Hearing Voices
        </h1>
        

        &lt;div class=&quot;key-message&quot;&gt;It&amp;#39;s to be expected that the following exercises may be tricky at various points. Practice is required, journaling is recommended, alongside therapy and other supportive relationships.&lt;/div&gt;
&lt;div class=&quot;press-pause&quot;&gt;
    &lt;h2&gt;Press Pause&lt;/h2&gt;
&lt;p&gt;&lt;div class=&quot;press-pause-section&quot;&gt;
&lt;div class=&quot;section-content&quot;&gt;
&lt;h3&gt;Strengthen Insight&lt;/h3&gt;
What helped you notice you were/are hearing a voice? What helps you accept that you hear sounds others do not?&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;journal-entry&quot; data-section=&quot;press_pause&quot; data-question=&quot;strengthen-insight&quot; style=&quot;display: none&quot;&gt;
&lt;textarea placeholder=&quot;Write your reflections here...&quot;&gt;&lt;/textarea&gt;
&lt;button class=&quot;save-entry&quot;&gt;Save&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;past-entries-sidebar&quot; data-section=&quot;press_pause&quot; data-question=&quot;strengthen-insight&quot; style=&quot;display: none&quot;&gt;
&lt;h4&gt;Previous Entries&lt;/h4&gt;
&lt;div class=&quot;past-entries&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;press-pause-section&quot;&gt;
&lt;div class=&quot;section-content&quot;&gt;
&lt;h3&gt;Mindfulness&lt;/h3&gt;
If you are experiencing a distressing voice, is it possible for you to try and pull your focus to your breathing for as long as you can?&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;journal-entry&quot; data-section=&quot;press_pause&quot; data-question=&quot;mindfulness&quot; style=&quot;display: none&quot;&gt;
&lt;textarea placeholder=&quot;Write your reflections here...&quot;&gt;&lt;/textarea&gt;
&lt;button class=&quot;save-entry&quot;&gt;Save&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;past-entries-sidebar&quot; data-section=&quot;press_pause&quot; data-question=&quot;mindfulness&quot; style=&quot;display: none&quot;&gt;
&lt;h4&gt;Previous Entries&lt;/h4&gt;
&lt;div class=&quot;past-entries&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;press-pause-section&quot;&gt;
&lt;div class=&quot;section-content&quot;&gt;
&lt;h3&gt;Distress Tolerance&lt;/h3&gt;
Is it possible for you to experience the distressing messages from the voice without needing to react? The &amp;lt;a href=&amp;quot;https://dbt.tools/distress_tolerance/index.php&amp;quot;&amp;gt;skills discussed here&amp;lt;/a&amp;gt; will likely be helpful.&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;journal-entry&quot; data-section=&quot;press_pause&quot; data-question=&quot;distress-tolerance&quot; style=&quot;display: none&quot;&gt;
&lt;textarea placeholder=&quot;Write your reflections here...&quot;&gt;&lt;/textarea&gt;
&lt;button class=&quot;save-entry&quot;&gt;Save&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;past-entries-sidebar&quot; data-section=&quot;press_pause&quot; data-question=&quot;distress-tolerance&quot; style=&quot;display: none&quot;&gt;
&lt;h4&gt;Previous Entries&lt;/h4&gt;
&lt;div class=&quot;past-entries&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;press-pause-section&quot;&gt;
&lt;div class=&quot;section-content&quot;&gt;
&lt;h3&gt;Imagination&lt;/h3&gt;
Can you imagine a shell between you and your voices? A membrane they could bounce off of that allows you to watch them but not to have to engage them? Like you&#39;re watching waves crash in the ocean. What does this boundary feel like?&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;journal-entry&quot; data-section=&quot;press_pause&quot; data-question=&quot;imagination&quot; style=&quot;display: none&quot;&gt;
&lt;textarea placeholder=&quot;Write your reflections here...&quot;&gt;&lt;/textarea&gt;
&lt;button class=&quot;save-entry&quot;&gt;Save&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;past-entries-sidebar&quot; data-section=&quot;press_pause&quot; data-question=&quot;imagination&quot; style=&quot;display: none&quot;&gt;
&lt;h4&gt;Previous Entries&lt;/h4&gt;
&lt;div class=&quot;past-entries&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;press-pause-section&quot;&gt;
&lt;div class=&quot;section-content&quot;&gt;
&lt;h3&gt;Your Own Idea&lt;/h3&gt;
What feels like it would help you create a sense of safety from which to get curious about your voices?&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;journal-entry&quot; data-section=&quot;press_pause&quot; data-question=&quot;your-own-idea&quot; style=&quot;display: none&quot;&gt;
&lt;textarea placeholder=&quot;Write your reflections here...&quot;&gt;&lt;/textarea&gt;
&lt;button class=&quot;save-entry&quot;&gt;Save&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;past-entries-sidebar&quot; data-section=&quot;press_pause&quot; data-question=&quot;your-own-idea&quot; style=&quot;display: none&quot;&gt;
&lt;h4&gt;Previous Entries&lt;/h4&gt;
&lt;div class=&quot;past-entries&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;activate-curiosity&quot;&gt;
    &lt;h2&gt;Activate Curiosity&lt;/h2&gt;
&lt;p&gt;&lt;div class=&quot;activate-curiosity-section&quot;&gt;
&lt;div class=&quot;section-content&quot;&gt;
&lt;h3&gt;Where do the voices come from?&lt;/h3&gt;
Can you identify familiar sounds or themes in the voices?&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;journal-entry&quot; data-section=&quot;activate_curiosity&quot; data-question=&quot;where-do-the-voices-come-from&quot; style=&quot;display: none&quot;&gt;
&lt;textarea placeholder=&quot;Write your reflections here...&quot;&gt;&lt;/textarea&gt;
&lt;button class=&quot;save-entry&quot;&gt;Save&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;past-entries-sidebar&quot; data-section=&quot;activate_curiosity&quot; data-question=&quot;where-do-the-voices-come-from&quot; style=&quot;display: none&quot;&gt;
&lt;h4&gt;Previous Entries&lt;/h4&gt;
&lt;div class=&quot;past-entries&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;activate-curiosity-section&quot;&gt;
&lt;div class=&quot;section-content&quot;&gt;
&lt;h3&gt;Why do the voices come from that place?&lt;/h3&gt;
Voices are one way the body tries to protect itself. Can you wonder about why your body chooses this specific way to take care of you?&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;journal-entry&quot; data-section=&quot;activate_curiosity&quot; data-question=&quot;why-do-the-voices-come-from-that-place&quot; style=&quot;display: none&quot;&gt;
&lt;textarea placeholder=&quot;Write your reflections here...&quot;&gt;&lt;/textarea&gt;
&lt;button class=&quot;save-entry&quot;&gt;Save&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;past-entries-sidebar&quot; data-section=&quot;activate_curiosity&quot; data-question=&quot;why-do-the-voices-come-from-that-place&quot; style=&quot;display: none&quot;&gt;
&lt;h4&gt;Previous Entries&lt;/h4&gt;
&lt;div class=&quot;past-entries&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;activate-curiosity-section&quot;&gt;
&lt;div class=&quot;section-content&quot;&gt;
&lt;h3&gt;Acceptance&lt;/h3&gt;
Can you cherish the hurt in the self the voices call back to?&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;journal-entry&quot; data-section=&quot;activate_curiosity&quot; data-question=&quot;acceptance&quot; style=&quot;display: none&quot;&gt;
&lt;textarea placeholder=&quot;Write your reflections here...&quot;&gt;&lt;/textarea&gt;
&lt;button class=&quot;save-entry&quot;&gt;Save&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;past-entries-sidebar&quot; data-section=&quot;activate_curiosity&quot; data-question=&quot;acceptance&quot; style=&quot;display: none&quot;&gt;
&lt;h4&gt;Previous Entries&lt;/h4&gt;
&lt;div class=&quot;past-entries&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;activate-curiosity-section&quot;&gt;
&lt;div class=&quot;section-content&quot;&gt;
&lt;h3&gt;What other questions or exercises can help you?&lt;/h3&gt;
What other practices or reflections would help you better live with your voices?&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;journal-entry&quot; data-section=&quot;activate_curiosity&quot; data-question=&quot;what-other-questions-or-exercises-can-help-you&quot; style=&quot;display: none&quot;&gt;
&lt;textarea placeholder=&quot;Write your reflections here...&quot;&gt;&lt;/textarea&gt;
&lt;button class=&quot;save-entry&quot;&gt;Save&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;past-entries-sidebar&quot; data-section=&quot;activate_curiosity&quot; data-question=&quot;what-other-questions-or-exercises-can-help-you&quot; style=&quot;display: none&quot;&gt;
&lt;h4&gt;Previous Entries&lt;/h4&gt;
&lt;div class=&quot;past-entries&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;script type=&quot;module&quot;&gt;
    // Get data from front matter
    const pressPause = [{&amp;quot;title&amp;quot;:&amp;quot;Strengthen Insight&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;What helped you notice you were/are hearing a voice? What helps you accept that you hear sounds others do not?&amp;#92;n&amp;quot;},{&amp;quot;title&amp;quot;:&amp;quot;Mindfulness&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;If you are experiencing a distressing voice, is it possible for you to try and pull your focus to your breathing for as long as you can?&amp;#92;n&amp;quot;},{&amp;quot;title&amp;quot;:&amp;quot;Distress Tolerance&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;Is it possible for you to experience the distressing messages from the voice without needing to react? The &amp;lt;a href=&amp;#92;&amp;quot;https://dbt.tools/distress_tolerance/index.php&amp;#92;&amp;quot;&amp;gt;skills discussed here&amp;lt;/a&amp;gt; will likely be helpful.&amp;#92;n&amp;quot;},{&amp;quot;title&amp;quot;:&amp;quot;Imagination&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;Can you imagine a shell between you and your voices? A membrane they could bounce off of that allows you to watch them but not to have to engage them? Like you&amp;#39;re watching waves crash in the ocean. What does this boundary feel like?&amp;#92;n&amp;quot;},{&amp;quot;title&amp;quot;:&amp;quot;Your Own Idea&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;What feels like it would help you create a sense of safety from which to get curious about your voices?&amp;#92;n&amp;quot;}];
    const activateCuriosity = [{&amp;quot;title&amp;quot;:&amp;quot;Where do the voices come from?&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;Can you identify familiar sounds or themes in the voices?&amp;#92;n&amp;quot;},{&amp;quot;title&amp;quot;:&amp;quot;Why do the voices come from that place?&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;Voices are one way the body tries to protect itself. Can you wonder about why your body chooses this specific way to take care of you?&amp;#92;n&amp;quot;},{&amp;quot;title&amp;quot;:&amp;quot;Acceptance&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;Can you cherish the hurt in the self the voices call back to?&amp;#92;n&amp;quot;},{&amp;quot;title&amp;quot;:&amp;quot;What other questions or exercises can help you?&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;What other practices or reflections would help you better live with your voices?&amp;#92;n&amp;quot;}];

    // Debug Supabase connection
    console.log(&#39;Checking Supabase connection...&#39;);
    const { data: testData, error: testError } = await supabase
        .from(&#39;prompts&#39;)
        .select(&#39;*&#39;)
        .limit(1);
    
    if (testError) {
        console.error(&#39;Supabase connection error:&#39;, testError);
    } else {
        console.log(&#39;Supabase connection successful, sample data:&#39;, testData);
    }

    // Check if user is authenticated
    const { data: { session } } = await supabase.auth.getSession()
    
    // Store prompt IDs
    let promptIds = {};

    // Show journal entries if signed in
    if (session) {
        // First, get or create prompts
        async function getPrompts() {
            try {
                console.log(&#39;Starting getOrCreatePrompts&#39;);
                // Get all prompts for this page at once
                const { data: prompts, error } = await supabase
                    .from(&#39;prompts&#39;)
                    .select(&#39;*&#39;)
                    .eq(&#39;page_type&#39;, &#39;hearing_voices&#39;)
                    .order(&#39;section_type&#39;, { ascending: true })
                    .order(&#39;display_order&#39;, { ascending: true });
                
                if (error) {
                    console.error(&#39;Error fetching prompts:&#39;, error);
                    return;
                }
                
                console.log(&#39;All prompts:&#39;, prompts);
                
                // Map prompts to their titles
                prompts.forEach(prompt =&gt; {
                    // Only take the first prompt if there are duplicates
                    if (!promptIds[prompt.title]) {
                        promptIds[prompt.title] = prompt.id;
                    }
                });
                
                console.log(&#39;Mapped promptIds:&#39;, promptIds);
                
            } catch (error) {
                console.error(&#39;Error in getOrCreatePrompts:&#39;, error);
                console.error(&#39;Stack:&#39;, error.stack);
            }
        }

        // Wait for prompts to be ready before showing UI
        await getPrompts();
        console.log(&#39;Prompts loaded:&#39;, promptIds);

        // Show both journal entries and sidebars for signed-in users
        document.querySelectorAll(&#39;.journal-entry&#39;).forEach(entry =&gt; {
            entry.style.display = &#39;block&#39;;
            console.log(&#39;Showing journal entry:&#39;, entry.dataset.question);
        });
        document.querySelectorAll(&#39;.past-entries-sidebar&#39;).forEach(sidebar =&gt; {
            sidebar.style.display = &#39;block&#39;;
            console.log(&#39;Showing sidebar:&#39;, sidebar.dataset.question);
        });

        // Double check that elements exist
        const journalEntries = document.querySelectorAll(&#39;.journal-entry&#39;);
        const sidebars = document.querySelectorAll(&#39;.past-entries-sidebar&#39;);
        console.log(`Found ${journalEntries.length} journal entries and ${sidebars.length} sidebars`);

        // Load past entries
        async function loadEntries() {
            const { data: entries, error } = await supabase
                .from(&#39;responses&#39;)
                .select(&#39;*&#39;)
                .eq(&#39;user_id&#39;, session.user.id)
                .order(&#39;created_at&#39;, { ascending: false });

            if (error) {
                console.error(&#39;Error loading entries:&#39;, error);
                return;
            }

            // Clear existing entries before loading
            document.querySelectorAll(&#39;.past-entries&#39;).forEach(container =&gt; {
                container.innerHTML = &#39;&#39;;
            });

            entries.forEach(entry =&gt; {
                const matchingPrompt = Object.entries(promptIds).find(([title, id]) =&gt; id === entry.prompt_id);
                if (!matchingPrompt) {
                    console.error(&#39;Could not find prompt for prompt_id:&#39;, entry.prompt_id);
                    return;
                }
                const [promptTitle, promptId] = matchingPrompt;
                
                const section = pressPause.find(item =&gt; item.title === promptTitle) 
                    ? &#39;press_pause&#39; 
                    : &#39;activate_curiosity&#39;;
                
                const questionSlug = promptTitle.toLowerCase().replace(/&#92;s+/g, &#39;-&#39;);
                
                // Try different selector combinations
                let container = null;
                const selectors = [
                    `[data-section=&quot;${section}&quot;][data-question=&quot;${questionSlug}&quot;] .past-entries-sidebar .past-entries`,
                    `.past-entries-sidebar[data-section=&quot;${section}&quot;][data-question=&quot;${questionSlug}&quot;] .past-entries`,
                    `.journal-entry[data-section=&quot;${section}&quot;][data-question=&quot;${questionSlug}&quot;] ~ .past-entries-sidebar .past-entries`
                ];
                
                for (const selector of selectors) {
                    container = document.querySelector(selector);
                    if (container) break;
                }
                
                console.log(&#39;Looking for container with:&#39;, {
                    promptTitle,
                    questionSlug,
                    section,
                    triedSelectors: selectors,
                    allContainers: Array.from(document.querySelectorAll(&#39;.past-entries&#39;)).map(el =&gt; ({
                        section: el.closest(&#39;[data-section]&#39;)?.dataset.section,
                        question: el.closest(&#39;[data-question]&#39;)?.dataset.question,
                        html: el.outerHTML.substring(0, 100) + &#39;...&#39;
                    })),
                    found: !!container
                });

                if (container) {
                    const entryEl = document.createElement(&#39;div&#39;);
                    entryEl.className = &#39;past-entry&#39;;
                    entryEl.dataset.entryId = entry.id;
                    entryEl.innerHTML = `
                        &lt;div class=&quot;entry-date&quot;&gt;${new Date(entry.created_at).toLocaleDateString()}&lt;/div&gt;
                        &lt;div class=&quot;entry-content&quot; contenteditable=&quot;true&quot;&gt;${escapeHtml(entry.content)}&lt;/div&gt;
                        &lt;div class=&quot;entry-actions&quot;&gt;
                            &lt;button class=&quot;save-edit&quot; style=&quot;display: none;&quot;&gt;Save&lt;/button&gt;
                            &lt;button class=&quot;cancel-edit&quot; style=&quot;display: none;&quot;&gt;Cancel&lt;/button&gt;
                            &lt;button class=&quot;delete-edit&quot; style=&quot;display: none;&quot;&gt;Delete&lt;/button&gt;
                        &lt;/div&gt;
                    `;

                    // Store original content for cancel functionality
                    const contentEl = entryEl.querySelector(&#39;.entry-content&#39;);
                    let originalContent = entry.content;
                    
                    // Show/hide buttons when editing
                    contentEl.addEventListener(&#39;focus&#39;, () =&gt; {
                        entryEl.querySelector(&#39;.save-edit&#39;).style.display = &#39;inline-block&#39;;
                        entryEl.querySelector(&#39;.cancel-edit&#39;).style.display = &#39;inline-block&#39;;
                        entryEl.querySelector(&#39;.delete-edit&#39;).style.display = &#39;inline-block&#39;;
                    });
                    
                    contentEl.addEventListener(&#39;blur&#39;, (e) =&gt; {
                        // Don&#39;t hide if clicking the action buttons
                        if (e.relatedTarget &amp;&amp; e.relatedTarget.closest(&#39;.entry-actions&#39;)) {
                            return;
                        }
                        // Hide buttons if clicking outside
                        if (!e.relatedTarget || !e.relatedTarget.closest(&#39;.past-entry&#39;)) {
                            setTimeout(() =&gt; {
                                if (!document.activeElement.closest(&#39;.past-entry&#39;)) {
                                    entryEl.querySelector(&#39;.save-edit&#39;).style.display = &#39;none&#39;;
                                    entryEl.querySelector(&#39;.cancel-edit&#39;).style.display = &#39;none&#39;;
                                    entryEl.querySelector(&#39;.delete-edit&#39;).style.display = &#39;none&#39;;
                                }
                            }, 100);
                        }
                    });

                    // Save edit
                    entryEl.querySelector(&#39;.save-edit&#39;).addEventListener(&#39;click&#39;, async () =&gt; {
                        const newContent = contentEl.textContent;
                        const { error } = await supabase
                            .from(&#39;responses&#39;)
                            .update({ content: newContent })
                            .eq(&#39;id&#39;, entry.id);
                            
                        if (error) {
                            console.error(&#39;Error updating entry:&#39;, error);
                            contentEl.textContent = originalContent;
                        } else {
                            originalContent = newContent;
                            entryEl.querySelector(&#39;.save-edit&#39;).style.display = &#39;none&#39;;
                            entryEl.querySelector(&#39;.cancel-edit&#39;).style.display = &#39;none&#39;;
                            entryEl.querySelector(&#39;.delete-edit&#39;).style.display = &#39;none&#39;;
                        }
                    });
                    
                    // Cancel edit
                    entryEl.querySelector(&#39;.cancel-edit&#39;).addEventListener(&#39;click&#39;, () =&gt; {
                        contentEl.textContent = originalContent;
                        entryEl.querySelector(&#39;.save-edit&#39;).style.display = &#39;none&#39;;
                        entryEl.querySelector(&#39;.cancel-edit&#39;).style.display = &#39;none&#39;;
                        entryEl.querySelector(&#39;.delete-edit&#39;).style.display = &#39;none&#39;;
                    });

                    // Delete entry
                    entryEl.querySelector(&#39;.delete-edit&#39;).addEventListener(&#39;click&#39;, async () =&gt; {
                        if (confirm(&#39;Are you sure you want to delete this entry?&#39;)) {
                            const { error } = await supabase
                                .from(&#39;responses&#39;)
                                .delete()
                                .eq(&#39;id&#39;, entry.id);
                                
                            if (error) {
                                console.error(&#39;Error deleting entry:&#39;, error);
                            } else {
                                entryEl.remove();
                            }
                        }
                    });

                    container.appendChild(entryEl);
                } else {
                    console.error(&#39;Could not find container for entry:&#39;, {
                        promptTitle,
                        questionSlug,
                        section,
                        triedSelectors: selectors,
                        entry
                    });
                }
            });
        }

        // Save new entry
        async function saveEntry(section, question, content) {
            console.log(&#39;saveEntry called with:&#39;, { section, question, content });
            console.log(&#39;Looking up prompt ID for:&#39;, question);
            console.log(&#39;Available promptIds:&#39;, promptIds);
            const promptId = promptIds[question];  // Use original case
            if (!promptId) {
                console.error(&#39;No prompt ID found for question:&#39;, question);
                console.error(&#39;Available questions:&#39;, Object.keys(promptIds));
                return false;
            }

            console.log(&#39;Attempting to save to responses table:&#39;, { 
                content,
                prompt_id: promptId,
                user_id: session.user.id 
            });

            const { data, error } = await supabase
                .from(&#39;responses&#39;)
                .insert([
                    { 
                        content: content,
                        prompt_id: promptId,
                        user_id: session.user.id
                    }
                ])
                .select();

            if (error) {
                console.error(&#39;Error saving entry:&#39;, {
                    message: error.message,
                    details: error.details,
                    hint: error.hint,
                    code: error.code
                });
                return false;
            }

            console.log(&#39;Entry saved successfully:&#39;, data);
            // Add new entry to UI immediately
            const questionSlug = question.toLowerCase().replace(/&#92;s+/g, &#39;-&#39;);
            const pastEntriesContainer = document.querySelector(
                `[data-section=&quot;${section}&quot;][data-question=&quot;${questionSlug}&quot;] .past-entries-sidebar .past-entries`
            );
            
            if (pastEntriesContainer) {
                const entryEl = document.createElement(&#39;div&#39;);
                entryEl.className = &#39;past-entry&#39;;
                entryEl.dataset.entryId = data[0].id;
                entryEl.innerHTML = `
                    &lt;div class=&quot;entry-date&quot;&gt;${new Date().toLocaleDateString()}&lt;/div&gt;
                    &lt;div class=&quot;entry-content&quot; contenteditable=&quot;true&quot;&gt;${escapeHtml(content)}&lt;/div&gt;
                    &lt;div class=&quot;entry-actions&quot;&gt;
                        &lt;button class=&quot;save-edit&quot; style=&quot;display: none;&quot;&gt;Save&lt;/button&gt;
                        &lt;button class=&quot;cancel-edit&quot; style=&quot;display: none;&quot;&gt;Cancel&lt;/button&gt;
                        &lt;button class=&quot;delete-edit&quot; style=&quot;display: none;&quot;&gt;Delete&lt;/button&gt;
                    &lt;/div&gt;
                `;
                
                // Add the same edit functionality as in loadEntries
                const contentEl = entryEl.querySelector(&#39;.entry-content&#39;);
                let originalContent = content;
                
                contentEl.addEventListener(&#39;focus&#39;, () =&gt; {
                    entryEl.querySelector(&#39;.save-edit&#39;).style.display = &#39;inline-block&#39;;
                    entryEl.querySelector(&#39;.cancel-edit&#39;).style.display = &#39;inline-block&#39;;
                    entryEl.querySelector(&#39;.delete-edit&#39;).style.display = &#39;inline-block&#39;;
                });
                
                contentEl.addEventListener(&#39;blur&#39;, (e) =&gt; {
                    // Don&#39;t hide if clicking the action buttons
                    if (e.relatedTarget &amp;&amp; e.relatedTarget.closest(&#39;.entry-actions&#39;)) {
                        return;
                    }
                    // Hide buttons if clicking outside
                    if (!e.relatedTarget || !e.relatedTarget.closest(&#39;.past-entry&#39;)) {
                        setTimeout(() =&gt; {
                            if (!document.activeElement.closest(&#39;.past-entry&#39;)) {
                                entryEl.querySelector(&#39;.save-edit&#39;).style.display = &#39;none&#39;;
                                entryEl.querySelector(&#39;.cancel-edit&#39;).style.display = &#39;none&#39;;
                                entryEl.querySelector(&#39;.delete-edit&#39;).style.display = &#39;none&#39;;
                            }
                        }, 100);
                    }
                });
                
                entryEl.querySelector(&#39;.save-edit&#39;).addEventListener(&#39;click&#39;, async () =&gt; {
                    const newContent = contentEl.textContent;
                    const { error } = await supabase
                        .from(&#39;responses&#39;)
                        .update({ content: newContent })
                        .eq(&#39;id&#39;, data[0].id);
                        
                    if (error) {
                        console.error(&#39;Error updating entry:&#39;, error);
                        contentEl.textContent = originalContent;
                    } else {
                        originalContent = newContent;
                        entryEl.querySelector(&#39;.save-edit&#39;).style.display = &#39;none&#39;;
                        entryEl.querySelector(&#39;.cancel-edit&#39;).style.display = &#39;none&#39;;
                        entryEl.querySelector(&#39;.delete-edit&#39;).style.display = &#39;none&#39;;
                    }
                });
                
                entryEl.querySelector(&#39;.cancel-edit&#39;).addEventListener(&#39;click&#39;, () =&gt; {
                    contentEl.textContent = originalContent;
                    entryEl.querySelector(&#39;.save-edit&#39;).style.display = &#39;none&#39;;
                    entryEl.querySelector(&#39;.cancel-edit&#39;).style.display = &#39;none&#39;;
                    entryEl.querySelector(&#39;.delete-edit&#39;).style.display = &#39;none&#39;;
                });
                
                // Insert at the top of the list
                pastEntriesContainer.insertBefore(entryEl, pastEntriesContainer.firstChild);
            }

            return true;
        }

        // Helper function to escape HTML
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&amp;/g, &quot;&amp;amp;&quot;)
                .replace(/&lt;/g, &quot;&amp;lt;&quot;)
                .replace(/&gt;/g, &quot;&amp;gt;&quot;)
                .replace(/&quot;/g, &quot;&amp;quot;&quot;)
                .replace(/&#39;/g, &quot;&amp;#039;&quot;);
        }

        // Add event listeners to save buttons
        document.querySelectorAll(&#39;.save-entry&#39;).forEach(button =&gt; {
            button.addEventListener(&#39;click&#39;, async () =&gt; {
                const journalEntry = button.closest(&#39;.journal-entry&#39;)
                const textarea = journalEntry.querySelector(&#39;textarea&#39;)
                const section = journalEntry.dataset.section
                // Find the original title from the slug
                const questionSlug = journalEntry.dataset.question
                const items = section === &#39;press_pause&#39; ? pressPause : activateCuriosity
                const originalQuestion = items.find(item =&gt; item.title.toLowerCase().replace(/&#92;s+/g, &#39;-&#39;) === questionSlug)?.title
                
                if (!originalQuestion) {
                    console.error(&#39;Could not find original question for slug:&#39;, questionSlug)
                    return
                }

                const content = textarea.value.trim()

                if (content) {
                    const success = await saveEntry(section, originalQuestion, content)
                    if (success) {
                        // Add new entry to UI immediately
                        const pastEntriesContainer = document.querySelector(`[data-section=&quot;${section}&quot;][data-question=&quot;${questionSlug}&quot;] .past-entries-sidebar .past-entries`)
                        if (pastEntriesContainer) {
                            const entryEl = document.createElement(&#39;div&#39;)
                            entryEl.className = &#39;past-entry&#39;
                            entryEl.innerHTML = `
                                &lt;div class=&quot;entry-date&quot;&gt;${new Date().toLocaleDateString()}&lt;/div&gt;
                                &lt;div class=&quot;entry-content&quot;&gt;${escapeHtml(content)}&lt;/div&gt;
                            `
                            // Insert at the top of the list
                            pastEntriesContainer.insertBefore(entryEl, pastEntriesContainer.firstChild)
                            textarea.value = &#39;&#39;
                        }
                    }
                }
            })
        })

        // Load entries on page load
        loadEntries()
    }
&lt;/script&gt;

    </div>
    
    <footer class="site-footer">
        <span class="handshake">🤝</span>
        <p>a <a href="https://www.mutua.nyc">mutua.nyc</a> collaboration</p>
        <span class="handshake">🤝</span>
    </footer>

    <script type="module">
        import { AuthUI } from '/js/auth.js'
        
        const authButton = document.getElementById('authButton')
        const authModal = document.getElementById('authModal')
        const authContainer = document.getElementById('authContainer')
        
        let auth = null

        if (authButton) {
            authButton.addEventListener('click', async (e) => {
                e.preventDefault()
                e.stopPropagation()

                // If user is signed in, sign them out
                if (authButton.textContent === 'Sign Out') {
                    await supabase.auth.signOut()
                    authButton.textContent = 'Sign In'
                    // Don't show the auth modal after signing out
                    return
                }

                // Show sign in modal
                if (authModal) {
                    authModal.classList.add('visible')
                    authModal.classList.remove('hidden')
                    if (!auth) {
                        auth = AuthUI({ container: authContainer })
                    }
                }
            })
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            if (authModal && !authModal.contains(e.target) && !authButton.contains(e.target)) {
                authModal.classList.remove('visible')
                authModal.classList.add('hidden')
            }
        })

        // Prevent clicks inside modal from closing it
        if (authModal) {
            authModal.addEventListener('click', (e) => {
                e.stopPropagation()
            })
        }

        // Check auth state on page load and changes
        supabase.auth.onAuthStateChange((event, session) => {
            if (session) {
                // User is signed in
                // Hide the auth modal when signed in
                authModal.classList.remove('visible')
                authModal.classList.add('hidden')
                authButton.textContent = 'Sign Out'
                // Redirect to hearing voices page if on home page
                if (window.location.pathname === '/') {
                    window.location.href = '/hearing-voices';
                }
            } else {
                // User is signed out
                // Clear the auth UI when signed out
                auth = null
                authContainer.innerHTML = ''
                authButton.textContent = 'Sign In'
            }
        })

        // Initial check
        const { data: { session } } = await supabase.auth.getSession()
        if (session) {
            authButton.textContent = 'Sign Out'
            // Redirect to hearing voices page if on home page
            if (window.location.pathname === '/') {
                window.location.href = '/hearing-voices';
            }
        }
    </script>
</body>
</html> 